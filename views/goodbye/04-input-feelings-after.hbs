<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Goodbye</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css"/>
    <script src="/javascripts/utils.js"></script>
    <script src="/javascripts/exit.js"></script>
</head>
<body onunload="">

<div id="default">
    <h1>How do you feel now?</h1>
    {{> selection_area}}
</div>

<script>
    let url = new URL(window.location.href);
    let oldX = url.searchParams.get("x");
    let oldY = url.searchParams.get("y");

    // go back on 'restart'
    document.getElementById("restart").addEventListener("click", function() {
        window.location.assign("/goodbye/01-hello");
    });

    // selection area controls
    let point = {x: 0, y: 0};
    let nextElem = document.getElementById("next");
    let eventElem = document.getElementById("selection-events");
    eventElem.addEventListener('update', function(e) {
        point.x = e.detail.x;
        point.y = e.detail.y;
        nextElem.classList.remove("hide");
    });

    // go forward on 'done'
    document.getElementById("next").addEventListener("click", function() {
        fetch('/data/fullAdd', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                x1: oldX,
                y1: oldY,
                x2: point.x,
                y2: point.y
            }),
        }).then((data) => {
            window.location.assign("/goodbye/05-thank-you");
        }).catch((error) => {
            window.location.assign("/goodbye/05-thank-you");
        });
    });

    // go back to intro after timeout
    SetExitTimer();

</script>
<script src="/javascripts/selection.js"></script>

</body>
</html>