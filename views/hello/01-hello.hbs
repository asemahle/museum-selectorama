<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Stephie&#x27;s Blank Site</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    <link href="/css/normalize.css" rel="stylesheet" type="text/css">
    <link href="/css/webflow.css" rel="stylesheet" type="text/css">
    <link href="/css/stephies-blank-site-a706d0.webflow.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({  google: {    families: ["Roboto:regular","Poppins:regular","Poppins:regular,500,600,700,800,900","Roboto:regular,500,700,900","Poppins:100,200,300,regular,500,600,700,800,900","Roboto:100,300,regular,500,700,900"]  }});</script>
    <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
    <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>

    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css"/>
    <script src="/javascripts/utils.js"></script>
</head>
<body class="body" onunload="">

<div class="div-block-2"></div>
<h1 class="heading">Hello</h1>
<p class="paragraph">Do you want to be part of a quick research study? <br>Help us by filling out this quick survey.<br>‚Äç<br>Your name will not be attached <br>to the data we collect.<br><br></p>
<div class="w-form">
    <form id="email-form" name="email-form" data-name="Email Form">
        <input type="text" maxlength="256" placeholder="Name / Pseudonym" id="name" class="text-field w-input">
        <div id="invalid-name" class="hide">
            That name is in use: please choose another
        </div>
        <a id="submit" class="hide button-3 w-button">Submit</a>
    </form>
</div>

<!--
<h1>Hello</h1>
<p>Filler text</p>

<input type="text" id="name">

<div id="invalid-name" class="hide">
    That name is in use: please choose another
</div>

<div id="submit" class="hide">
    Submit
</div>
-->

<script>
    let activeNames = []; // names with incomplete records
    let submitContainer = document.getElementById("submit");
    let inputField = document.getElementById("name");
    let invalidName = document.getElementById("invalid-name");

    // clear input on reload
    inputField.value = "";

    // show and hide the submit button based on whether there is a name
    inputField.addEventListener("input", function() {
        let name = this.value.trim();
        let nameIsUnique = activeNames.indexOf(name.toLowerCase()) === -1;
        if (name.length && nameIsUnique) {
            submitContainer.classList.remove("hide");
        } else {
            submitContainer.classList.add("hide");
        }
        if (nameIsUnique) {
            invalidName.classList.add("hide");
        } else {
            invalidName.classList.remove("hide");
        }
    });

    // go to next page on submit
    submitContainer.addEventListener("click", function() {
        let params = {
            name: inputField.value.trim()
        };
        window.location.assign("/hello/02-input-feelings?" + encodeGetParams(params));
    });

    // get data to prevent duplicate names
    function UpdateNames() {
        fetch('/data', { method: 'GET', headers: { 'Content-Type': 'application/json', }, })
                .then((response) => response.json())
                .then((data) => {
                    console.log('Success:', data);
                    activeNames = data.filter(user => user.IS_COMPLETED === 0).map(user => user.DISPLAY_ID.trim().toLowerCase());
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
    }


    // listen for updates
    const source = new EventSource('/data/stream');
    source.addEventListener('message', function(e) {
        console.log("DATA RECEIVED", e.data);
        UpdateNames();
    }, false);

    // initial update
    UpdateNames();
</script>

</body>
</html>